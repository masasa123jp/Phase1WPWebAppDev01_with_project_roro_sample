XServer Test Login プラグイン
============================

本プラグインは XServer の WordPress 環境で動作する、認証統合プラグインです。
Google(Firebase) / LINE(LIFF) のソーシャルログイン、ローカルのログイン/新規登録、
ログイン監査（IP/UA/時刻/結果）記録、そして簡易 CRUD デモを提供します。

インストール
------------
1. フォルダを `xserver-test-login/` として `wp-content/plugins/` に設置してください。
2. 画像を配置します：
   - `xserver-test-login/assets/img/logo_roro.png`（ロゴ）
   - `xserver-test-login/assets/img/favicon.ico`（ファビコン）
3. WordPress 管理画面の「プラグイン」から有効化します。
4. 初回有効化時に以下のテーブルが自動作成されます：
   - `wp_test`（CRUD デモ用）
   - `wp_social_login_users`（ソーシャルユーザー情報）
   - `wp_login_audit`（ログイン監査ログ）

設定（Firebase / LINE）
----------------------
管理画面の **設定 > RORO ログイン設定** で Firebase および LINE(LIFF) の各値を保存してください。
保存した設定はショートコードで引数を指定しなかった場合に自動的に使用されます。

使い方
------
- **統一認証 UI（推奨）**：固定ページに次のショートコードを設置します。

  ```
  [roro_auth]
  ```

  1 つのカード内で「ログイン」と「新規登録」を切り替え、Google / LINE ボタンをまとめて表示します。
  ローカルでのログイン/登録およびソーシャル認証の成功・失敗は `wp_login_audit` に記録されます。

  ログイン画面の下部には **「こちらから新規登録」** というリンクが表示されます。このリンクをクリックすると、ペットの基本情報や住所情報などを入力する専用フォームに切り替わります。

  この新規登録フォームでは以下の項目を入力できます。

  - **基本情報**：ペットの名前（後から変更できません）、フリガナ（自動的にカタカナ入力が推奨されます）、電話番号、連絡先メールアドレスなど
  - **住所**：郵便番号から住所を自動入力するボタン付きで、都道府県・市区町村・番地/建物名・自由記入欄を入力します
  - **ペット情報**：犬か猫かの種別、犬の場合は犬種情報、年齢カテゴリー（子犬/子猫、成犬/成猫、シニア犬/シニア猫）、利用言語（日本語・英語・中国語・韓国語）
  - **プライバシーポリシーへの同意**：チェックボックスをオンにしなければ送信できません

  入力完了後に送信すると、入力内容の検証結果が画面に表示されます（現在の実装ではデータベースに保存しません）。登録が完了すると成功メッセージが表示され、トップページへ戻ることができます。


- **CRUD デモ**：

  ```
  [test_crud_form]
  ```

  HelloWorld の見出しと、簡易的なデータ追加/更新/削除フォームを表示します。

- **互換ショートコード（旧UI）**：以前のバージョンとの互換性のため、以下も使用できますが、新UIの利用を推奨します。

  - ローカルログインフォーム：`[local_login_form]`
  - 新規ユーザー登録フォーム：`[local_register_form]`

ロゴ / Favicon
---------------
- ログイン画面のロゴとサイトのファビコンは、上記画像ファイルを自動参照します。表示されない場合は、ファイルのパスや権限、キャッシュ、および HTTPS 混在コンテンツの有無を確認してください。

注意事項
--------
- Firebase/LINE の構成情報は **設定画面にのみ保存**し、公開リポジトリに直書きしないでください。
- LINE のメール取得には `email` スコープと利用者の同意が必要です。取得できない場合は空値となります。
- 実運用前にテスト環境で十分に検証してください。